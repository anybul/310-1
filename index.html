<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=960">
    <link href="style.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="production.min.js"></script>

<style type="text/css">

#field{
    background-image:url('source/screens/02-3.jpg');
	background-size:100%;
}
.red-point{
    width:20px;
	height:20px;
	margin-top:-20px;
	margin-left:-20px;
	border-radius:10px;
	background-color:#FF7877;
	z-index: 10;
}
#field[data-task="1"] .step+#description{
    width:250px;
	text-align:center;
    top: 349px;
    left: 355px;
}
#field[data-task="1"].finished .step+#description{
    opacity:0;
	transition-duration:1s;
}
#field[data-task="1"] #image0{
    background-image:url('images/cell.jpg');
	width:309px;
	height:167px;
    top: 104px;
    left: 338px;
}
#field[data-task="1"] #image1{
    background-image:url('images/fish.jpg');
	width:389px;
	height:227px;
    top: 74px;
    left: 257px;
	opacity:0;
}
#field[data-task="1"].finished #image0{
    opacity:0;
	transition-duration:2s;
}
#field[data-task="1"].finished #image1{
    opacity:1;
	transition-duration:2s;
}

#field[data-task="1"] .clickable{
    top: 449px;
	height: 86px;
	width: 252px;
}
#field[data-task="1"] .clickable .inner-element{
    line-height: 82px;
}

#field[data-task="1"] #clickable1{
    left: 56px;
}
#field[data-task="1"] #clickable2,
#field[data-task="1"].finished #clickable3{
    left:354px;
}
#field[data-task="1"].finished .clickable{
    opacity:0;
	transition-duration:1s;
}
#field[data-task="1"].finished #clickable3{
    opacity:1;
}
#field[data-task="1"] #clickable3{
    left:652px;
}
#fishDialog{
    position:absolute;
	top: 424px;
    left: 102px;
	width: 752px;
    text-align: center;
    border-radius: 5px;
	background-color:#F0F0F0;
}
#fishDialog:before{
	content:'';
    background-image:url('images/grey-tail.png');
	background-size:44px;
	width:44px;
	height:46px;
	display:block;
	position:absolute;
	 top: 6px;
    left: -44px;

}
.fish-dialog-text{

	font-size: 28px;
	line-height: 38px;
    padding-top: 17px;
}
.button.fish-dialog-button{
    position: relative;
    display: inline-block;
	margin: 14px 0px 13px;
	padding: 0 40px 0;
}

#field[data-task="2"] #image0{
    background-image:url('images/fish.jpg');
	width:389px;
	height:227px;
    top: 122px;
    left: -206px;
}
#field[data-task="2"][data-substep="2"] #image0{
    width: 10px;
    height: 10px;
    top: 240px;
    left: 460px;
    z-index: 9;
	transition-duration:1s;
}
#field[data-task="2"][data-substep="3"] #image0{display:none;}
#field[data-task="2"][data-substep="2"] #image1,
#field[data-task="2"][data-substep="3"] #image1{display:none}
#field[data-task="2"] #image2,
#field[data-task="2"] #image4{display:none;}
#field[data-task="2"][data-substep="2"] #image2{display:block}
#field[data-task="2"][data-substep="2"] #fishDialog,
#field[data-task="2"][data-substep="3"] #fishDialog{
    display:none;
}
#field[data-task="2"] .draggable,
#field[data-task="2"] .droppable,
#field[data-task="2"] #image5{
    display:none;
}
#field[data-task="2"][data-substep="3"] .draggable,
#field[data-task="2"][data-substep="3"] .droppable,
#field[data-task="2"][data-substep="3"] #image5{
    display:block;
}
#field[data-task="2"][data-substep="3"] #image4{display:block}
#field[data-task="2"] .red-point{
    opacity:0;
}
@keyframes step2substep2anim {
	0%{opacity:0;}
	99%{opacity:0;}
	100%{opacity:1;}
}
#field[data-task="2"][data-substep="2"] .red-point{
    animation:step2substep2anim 1s linear;
    opacity:1;
    top: 255px;
    left: 478px;
}
#field[data-task="2"][data-substep="3"] .red-point{
    opacity:1;
}
#field[data-task="2"] #image1{
    background-image:url('images/02-1.jpg');
    width: 575px;
    height: 415px;
    top: 17px;
    left: 280px;
}
#field[data-task="2"] #image2{
    background-image:url('images/02-2.jpg');
    width: 575px;
    height: 415px;
    top: 17px;
    left: 280px;
}
@keyframes step2image4resize{
	0%{
		width: 575px;
		left: 280px;
	}
	100%{
		width: 460px;
		left: 458px;
	}
}
#field[data-task="2"][data-substep="3"] #image4{
    background-image:url('images/02-3.jpg');
    width: 575px;
    height: 415px;
    top: 17px;
    left: 280px;
}
#field[data-task="2"][data-substep="3"] #image4{
   
	width: 460px;
	left: 458px;
	animation: step2image4resize 1s linear;
}
#field[data-task="2"][data-substep="3"] #image3{
    top: 162px;
    left: 576px;
	transition-duration:1s;
	transition-timing-function:linear;
}
#field[data-task="3"] #image0,
#field[data-task="4"] #image0,
#field[data-task="4"] #image3{
    background-image:url('images/03-1.jpg');
    height: 415px;
    top: 17px;
	width: 460px;
	left: 458px;
}
#field[data-task="4"] #image3{
    opacity:0;
	background-image:url('images/03-4.jpg');
}
#field[data-task="4"].finished #image0{opacity:0;}

#field[data-task="4"].finished #image3{opacity:1;}

#field[data-task="2"][data-substep="3"].finished #image3{transition:0s;}
#field[data-task="2"][data-substep="3"] #image5,
#field[data-task="3"] #image1,
#field[data-task="4"] #image1,
#field[data-task="5"] #image1{
    width: 385px;
    height: 515px;
    top: 68px;
    left: 14px;
	background-color:#F0F0F0;
}
#field[data-task="2"][data-substep="3"] #image5 .inner-element,
#field[data-task="3"] #image1 .inner-element,
#field[data-task="4"] #image1 .inner-element,
#field[data-task="5"] #image1 .inner-element{
    top: 307px;
    font-size: 28px;
    line-height: 38px;
    position: absolute;
    width: 100%;
}
#field[data-task="3"] .red-point,
#field[data-task="4"] .red-point{
    top: 183px;
    left: 496px;
}
.draggable,
.droppable{
    left: 82px;
	width: 252px;
	height:50px;
}
#draggable1{
    top: 10px;
}
#draggable2{
    top: 75px;
}
#draggable3{
    top: 140px;
}
#droppable1{
    top:358px;
}
.draggable .inner-element{
    line-height: 46px;
    font-size: 28px;
    text-align: center;
}
@keyframes step3fishIntro{
    0%{
		top: 183px;
		left: 496px;
		width:0px;
		height:0px;
		background-size:0px;
		background-color:#FF7877;
		box-shadow:transparent 0px 0px 0px 0px;
	}
	100%{
		top: 318px;
		left: 438px;
		width: 487px;
		height: 264px;
		background-color:#ffffff;
	}
}
@keyframes step3fishOutro{
    0%{
		top: 318px;
		left: 438px;
		width: 487px;
		height: 264px;
		background-color:#ffffff;
		
	}
	100%{
		top: 183px;
		left: 496px;
		width:0px;
		height:0px;
		background-size:0px;
		background-color:#FF7877;
		box-shadow:transparent 0px 0px 0px 0px;
	}
}
#field[data-task="3"] #image3{
    top: 318px;
    left: 438px;
    width: 487px;
    height: 264px;
    border-radius: 5px;
    background-image: url(images/fish2.png);
    background-size: 359px;
	box-shadow: #FFED76 0px 0px 3px 3px;
	animation:step3fishIntro 1s linear;
	background-color:#ffffff;
}
#field[data-task="3"].finished #image3{
    top: 183px;
	left: 496px;
	width:0px;
	height:0px;
    animation:step3fishOutro 1s linear;
	transition-delay:0.7s;
	margin-left:-10px;
	margin-top:-10px;
}
#field[data-task="3"].finished #image3:before{
    content:'';
	display:block;
	position:absolute;
	top: 94px;
    left: 199px;
	width:91px;
	height:91px;
	background-image:url(images/co2.jpg);
	background-size:91px;
}
@media (-webkit-min-device-pixel-ratio: 1.5), (min-resolution: 144dpi){
	#field[data-task="1"] #image0{
        background-image:url('images/cell@2x.jpg');
    }
	#fishDialog:before{
		background-image:url('images/grey-tail@2x.png');
	}
	#field[data-task="2"] #image0{
        background-image:url('images/fish@2x.jpg');
	}
	#field[data-task="2"] #image1{
        background-image:url('images/02-1@2x.jpg');
	}
	#field[data-task="2"] #image2{
        background-image:url('images/02-2@2x.jpg');
	}
}

</style>

<script type="text/javascript">
function roundMovement(el, offsetTop, offsetLeft, radius, direction){
        //var radius = 90;
		//var offsetLeft = 395;
		//var offsetTop = 235;
		//direction true - против часовой
		//direction = false;
	    var x = el.position().left-offsetLeft;
		if(x>radius){
			x = radius;
		} else if(x<-radius){
			x=-radius;
		}
		if(
			(el.data('plusplus'))
		){
			x++;
		} else {
			x--;
		}
		
		var y2 = (radius*radius) - (x*x);
		if(y2<0){
			if(el.data('plusplus')){
				x = radius;
				el.data('plusplus','');
			} else {
				x = -1*radius;
				el.data('plusplus','true');
			}
		
		}
		if((el.data('plusplus') && direction)
			|| (!el.data('plusplus') && !direction)
		){
			el.css('top', offsetTop+Math.sqrt(y2));
		} else {
			el.css('top', offsetTop-Math.sqrt(y2));
		}
		
			
		el.css('left', x+offsetLeft);
}


var test_fish_dialog = {
    create:function(input){
		var result = [];
		var dialog = $('<div></div>').attr('id', 'fishDialog');
		if(input.text){
			dialog.append($('<div></div>').addClass('fish-dialog-text').html(input.text));
		}
		if(input.button){
			var button = $('<div></div>').addClass('fish-dialog-button').addClass('button').html(input.button);
			if(input.buttonclick){
				button.click(
					input.buttonclick
				);
			}
			
			dialog.append(button);
		}
		result.push(dialog);
		return result;
	}
};

var test_test = {
    create:function(){
		
		 
		    //$('#image3')
		
		return [];
	},
	onStart:function(){
/*	setInterval(function(){
		roundMovement($('#image3'), 235, 395, 90, true);
		roundMovement($('#image4'), 235, 660, 190, false);
	}, 10); 
*/
		//var radius = 90;
		//var offsetLeft = 395;
		//var offsetTop = 235;);
		
	}
};

//a2+b2=c2;

//a = sqrt(c2-b2);
//b = 
var task=[{},
// step1
{
    "description":"Как называется<br>такая клетка крови?",
//	"button":{},
	"nextStepDelay":2000,
	"test_preloadimg":[
		'img/art.png'
	],
	"test_images":[
		{},
		{}
	],
	"test_clickable":[
		{"multiselect":false,"autocheck":true},
		{"value":"лейкоцит"},
		{"value":"тромбоцит"},
		{"value":"эритроцит", "right":true}
	]
},
//2
{
    "nextStepDelay":3200,
    "test_fish_dialog":{
		"text":"Весь день кровь носит меня по организму кругами.<br>Давай нарисуем схему моего путешествия.",
		"button":"Начать",
		"buttonclick":function(){
			$('#field').attr('data-substep','2');
			//roundMovement(el, offsetTop, offsetLeft, radius, direction)
			
			var movement = function(){
				if($('#field').attr('data-task')=='2'){
					roundMovement($('#image3'), 235, 395, 90, true);
				}
				
			};
			for(var i=0;i<50;i++){
				setTimeout(movement, (i*30)+1000);
			}
			setTimeout(function(){
				if($('#field').attr('data-task')=='2'){
					$('#field').attr('data-substep','3');
					$('#image3').css({'top':'','left':''});
				}
			}, 2500)
		}
	},
	"test_images":[
		{},
		{},
		{},
		{"classes":"red-point"},
		{},
		{"value":"Малый круг идет<br>из сердца"}
		/* ,{"classes":"red-point"} */
	],
	"test_drag_n_drop":{
		"draggables":[
			{"returnable":true/*, "onWrong":"defaultplace"*/},
			{"value":"к голове"},
			{"value":"к легким"},
			{"value":"к другим органам"}
		],
		"droppables":[
			{"checkOnDrop":true},
			{"values":["к легким"]}
		]
	},
	"onFinish":function(){
		var movement = function(){
			if($('#field').attr('data-task')=='2'){
				roundMovement($('#image3'), 235, 550, 75, true);
			}
		};
		for(var i=0;i<80;i++){
			setTimeout(movement, (i*30)+1000);
		}
		//setInterval(movement, 10);
	}
	//test_test:[]
},
//3
{
   "nextStepDelay":2000,
    "test_images":[
	    {},
		{"value":"Направляясь в легкие,<br>я несу с собой"},
		{"classes":"red-point"},
		{}
	],
	"test_drag_n_drop":{
		"draggables":[
			{"returnable":true/*, "onWrong":"defaultplace"*/},
			{"value":"воду"},
			{"value":"кислород"},
			{"value":"углекислый газ"}
		],
		"droppables":[
			{"checkOnDrop":true},
			{"values":["углекислый газ"]}
		]
	}/*,
	*/
},
//4
{
    "nextStepDelay":2000,
    "test_images":[
	    {},
		{"value":"Кровь, в которой много<br>углекислого газа,<br>обычно рисуют"},
		{"classes":"red-point"},
		{}
	],
	"test_drag_n_drop":{
		"draggables":[
			{"returnable":true/*, "onWrong":"defaultplace"*/},
			{"value":"чёрным цветом"},
			{"value":"красным цветом"},
			{"value":"синим цветом"}
		],
		"droppables":[
			{"checkOnDrop":true},
			{"values":["синим цветом"]}
		]
	},
	"onFinish":function(){
		var movement = function(){
			if($('#field').attr('data-task')=='4'){
				roundMovement($('#image2'), 235, 550, 75, true);
			}
		};
		for(var i=0;i<22;i++){
			setTimeout(movement, (i*30)+1000);
		}
	}
},
//5
{
    "test_images":[
	    {},
		{"value":"Кровь, в которой много<br>углекислого газа,<br>обычно рисуют"},
		{"classes":"red-point"},
		{}
	],
	"test_drag_n_drop":{
		"draggables":[
			{"returnable":true/*, "onWrong":"defaultplace"*/},
			{"value":"чёрным цветом"},
			{"value":"красным цветом"},
			{"value":"синим цветом"}
		],
		"droppables":[
			{"checkOnDrop":true},
			{"values":["синим цветом"]}
		]
	}
},
//6
{
    "test_images":[
	    {},
		{"value":"Кровь, в которой много<br>углекислого газа,<br>обычно рисуют"},
		{"classes":"red-point"},
		{}
	],
	"test_drag_n_drop":{
		"draggables":[
			{"returnable":true/*, "onWrong":"defaultplace"*/},
			{"value":"чёрным цветом"},
			{"value":"красным цветом"},
			{"value":"синим цветом"}
		],
		"droppables":[
			{"checkOnDrop":true},
			{"values":["синим цветом"]}
		]
	}
}
]
</script>

</head>
<body>
	<!--div class="zbrdv" style="position:absolute;z-index:5;" onclick="nexStep()">next
	</div-->
</body>
</html>
